<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rjsoncons">
<title>Transform and Validate JSON and NDJSON • rjsoncons</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transform and Validate JSON and NDJSON">
<meta property="og:description" content="rjsoncons">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rjsoncons</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_rjsoncons.html">Transform and Validate JSON and NDJSON</a>
    <a class="dropdown-item" href="../articles/b_ndjson_extended.html">Processing NDJSON</a>
    <a class="dropdown-item" href="../articles/c_examples.html">Examples</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mtmorgan/rjsoncons/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transform and Validate JSON and NDJSON</h1>
                        <h4 data-toc-skip class="author">Martin
Morgan</h4>
            <address class="author_afil">
      Roswell Park Comprehensive Cancer Center, Buffalo, NY,
US<br><h4 data-toc-skip class="author">Marcel
Ramos</h4>
            <address class="author_afil">
      CUNY School of Public Health at Hunter College, New York, NY,
US<br><small class="dont-index">Source: <a href="https://github.com/mtmorgan/rjsoncons/blob/HEAD/vignettes/a_rjsoncons.Rmd" class="external-link"><code>vignettes/a_rjsoncons.Rmd</code></a></small>
      <div class="d-none name"><code>a_rjsoncons.Rmd</code></div>
    </address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="introduction-installation">Introduction &amp; installation<a class="anchor" aria-label="anchor" href="#introduction-installation"></a>
</h2>
<p>Use <a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a> for
querying, transforming, and searching JSON, NDJSON, or R objects using
<a href="https://jmespath.org/" class="external-link">JMESpath</a>, <a href="https://goessner.net/articles/JsonPath/" class="external-link">JSONpath</a>, or <a href="https://datatracker.ietf.org/doc/html/rfc6901" class="external-link">JSONpointer</a>. <a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a> supports <a href="https://jsonpatch.com/" class="external-link">JSON patch</a> for document editing, and
<a href="https://json-schema.org/" class="external-link">JSON schema</a> validation. Link to
the package for direct access to additional features in the <a href="https://github.com/danielaparker/jsoncons/" class="external-link">jsoncons</a> C++
library.</p>
<p>Install the released package version from CRAN</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rjsoncons"</span>, repos <span class="op">=</span> <span class="st">"https://CRAN.R-project.org"</span><span class="op">)</span></span></code></pre></div>
<p>Install the development version with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quiety <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span>, repos <span class="op">=</span> <span class="st">"https://CRAN.R-project.org"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mtmorgan/rjsoncons"</span><span class="op">)</span></span></code></pre></div>
<p>Attach the installed package to your <em>R</em> session, and check
the version of the C++ library in use</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a></span><span class="op">)</span></span>
<span><span class="fu">rjsoncons</span><span class="fu">::</span><span class="fu"><a href="../reference/version.html">version</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "0.173.4 [+57967655d]"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="query-and-pivot">Query and pivot<a class="anchor" aria-label="anchor" href="#query-and-pivot"></a>
</h2>
<p>Functions in this package work on JSON or NDJSON character vectors,
file paths and URLs to JSON or NDJSON documents, and <em>R</em> objects
that can be transformed to a JSON string.</p>
<div class="section level3">
<h3 id="select-filter-and-transform-with-j_query">Select, filter and transform with <code>j_query()</code><a class="anchor" aria-label="anchor" href="#select-filter-and-transform-with-j_query"></a>
</h3>
<p>Here is a simple JSON example document</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">  "locations": [</span></span>
<span><span class="st">    {"name": "Seattle", "state": "WA"},</span></span>
<span><span class="st">    {"name": "New York", "state": "NY"},</span></span>
<span><span class="st">    {"name": "Bellevue", "state": "WA"},</span></span>
<span><span class="st">    {"name": "Olympia", "state": "WA"}</span></span>
<span><span class="st">  ]</span></span>
<span><span class="st">}'</span></span></code></pre></div>
<p>There are several common use cases. Use <a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a> to query the
JSON string using <a href="https://goessner.net/articles/JsonPath/" class="external-link">JSONpath</a>, <a href="https://jmespath.org/" class="external-link">JMESpath</a> or <a href="https://datatracker.ietf.org/doc/html/rfc6901" class="external-link">JSONpointer</a>
syntax to filter larger documents to records of interest, e.g., only
cities in New York state, using ‘JMESpath’ syntax.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">json</span>, <span class="st">"locations[?state == 'NY']"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## [{"name":"New York","state":"NY"}]</span></span></code></pre></div>
<p>Use the <code>as = "R"</code> argument to extract deeply nested
elements as <em>R</em> objects, e.g., a character vector of city names
in Washington state.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">json</span>, <span class="st">"locations[?state == 'WA'].name"</span>, as <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="co">## [1] "Seattle"  "Bellevue" "Olympia"</span></span></code></pre></div>
<p>The JSON Pointer specification is simpler, indexing a single object
in the document. JSON arrays are 0-based.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">json</span>, <span class="st">"/locations/0/state"</span><span class="op">)</span></span>
<span><span class="co">## [1] "WA"</span></span></code></pre></div>
<p>The examples above use <code><a href="../reference/rquerypivot.html">j_query()</a></code>, which automatically
infers query specification from the form of <code>path</code> using
<code><a href="../reference/j_data_type.html">j_path_type()</a></code>. It may be useful to indicate query
specification more explicitly using <code><a href="../reference/zzz_paths_and_pointer.html">jsonpointer()</a></code>,
<code><a href="../reference/zzz_paths_and_pointer.html">jsonpath()</a></code>, or <code><a href="../reference/zzz_paths_and_pointer.html">jmespath()</a></code>; examples
illustrating features available for each query specification are on the
help pages <code><a href="../reference/zzz_paths_and_pointer.html">?jsonpointer</a></code>, <code><a href="../reference/zzz_paths_and_pointer.html">?jsonpath</a></code>, and
<code><a href="../reference/zzz_paths_and_pointer.html">?jmespath</a></code>.</p>
</div>
<div class="section level3">
<h3 id="array-of-objects-to-r-data-frame-with-j_pivot">Array-of-objects to <em>R</em> data.frame with
<code>j_pivot()</code><a class="anchor" aria-label="anchor" href="#array-of-objects-to-r-data-frame-with-j_pivot"></a>
</h3>
<p>The following transforms a nested JSON document into a format that
can be incorporated directly in <em>R</em> as a
<code>data.frame</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">    name: locations[].name,</span></span>
<span><span class="st">    state: locations[].state</span></span>
<span><span class="st">}'</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">path</span>, as <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##       name state</span></span>
<span><span class="co">## 1  Seattle    WA</span></span>
<span><span class="co">## 2 New York    NY</span></span>
<span><span class="co">## 3 Bellevue    WA</span></span>
<span><span class="co">## 4  Olympia    WA</span></span></code></pre></div>
<p>The transformation from JSON ‘array-of-objects’ to ‘object-of-arrays’
suitable for direct representation as a <code>data.frame</code> is
common, and is implemented directly as <code><a href="../reference/rquerypivot.html">j_pivot()</a></code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_pivot</a></span><span class="op">(</span><span class="va">json</span>, <span class="st">"locations"</span>, as <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="co">##       name state</span></span>
<span><span class="co">## 1  Seattle    WA</span></span>
<span><span class="co">## 2 New York    NY</span></span>
<span><span class="co">## 3 Bellevue    WA</span></span>
<span><span class="co">## 4  Olympia    WA</span></span></code></pre></div>
<p><code><a href="../reference/rquerypivot.html">j_pivot()</a></code> also support <code>as = "tibble"</code> when
the <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">dplyr</a> package
is installed.</p>
</div>
<div class="section level3">
<h3 id="ndjson-support">NDJSON support<a class="anchor" aria-label="anchor" href="#ndjson-support"></a>
</h3>
<p><a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a>
supports <a href="https://ndjson.org/" class="external-link">NDJSON</a> (new-line delimited
JSON). NDJSON consists of a file or character vector where each line /
element represents a JSON record. This example uses data from the <a href="https://www.gharchive.org/" class="external-link">GitHub Archive</a> project recording
all actions on public GitHub repositories. The data included in the
package are the first 10 lines of <a href="https://data.gharchive.org/2023-02-08-0.json.gz" class="external-link uri">https://data.gharchive.org/2023-02-08-0.json.gz</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndjson_file</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rjsoncons"</span>, <span class="st">"extdata"</span>, <span class="st">"2023-02-08-0.json"</span><span class="op">)</span></span></code></pre></div>
<p>NDJSON can be read into R
(<code>ndjson &lt;- readLines(ndjson_file)</code>) and used in
<code><a href="../reference/rquerypivot.html">j_query()</a></code> / <code><a href="../reference/rquerypivot.html">j_pivot()</a></code>, but it is often better
to leave full NDJSON files on disk. Thus the first argument to
<code><a href="../reference/rquerypivot.html">j_query()</a></code> or <code><a href="../reference/rquerypivot.html">j_pivot()</a></code> is usually a (text or
gz-compressed) file path or URL. Two additional options are available
when working with NDJSON. <code>n_records</code> limits the number of
records processed. Using <code>n_records</code> can be very useful when
exploring the data. For instance, the first record of a file can be
viewed interactively with</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">ndjson_file</span>, n_records <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">listviewer</span><span class="fu">::</span><span class="fu">jsonedit</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The option <code>verbose = TRUE</code> adds a progress indicator,
which provides confidence that progress is being made while parsing
large files. The progress bar requires the <a href="https://CRAN.R-project.org/package=cli" class="external-link">cli</a> package.</p>
<p><code><a href="../reference/rquerypivot.html">j_query()</a></code> provides a one-to-one mapping of NDJSON lines
/ elements to the return value, e.g.,
<code>j_query(ndjson_file, "@", as = "string")</code> on an NDJSON file
with 1000 lines will return a character vector of 1000 elements, or with
<code>j_query(ndjson, "@", as = "R")</code> an <em>R</em> list with
length 1000.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">ndjson_file</span>, <span class="st">"{id: id, type: type}"</span>, n_records <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## [1] "{\"id\":\"26939254345\",\"type\":\"DeleteEvent\"}"</span></span>
<span><span class="co">## [2] "{\"id\":\"26939254358\",\"type\":\"PushEvent\"}"  </span></span>
<span><span class="co">## [3] "{\"id\":\"26939254361\",\"type\":\"CreateEvent\"}"</span></span>
<span><span class="co">## [4] "{\"id\":\"26939254365\",\"type\":\"CreateEvent\"}"</span></span>
<span><span class="co">## [5] "{\"id\":\"26939254366\",\"type\":\"PushEvent\"}"</span></span></code></pre></div>
<p><code><a href="../reference/rquerypivot.html">j_pivot()</a></code> transforms an NDJSON file or character vector
of objects into a format convenient for input in <em>R</em>.
<code><a href="../reference/rquerypivot.html">j_pivot()</a></code> with NDJSON files and JMESpath paths work
particularly well together, because JMESpath provides flexibility in
creating JSON objects to be pivoted.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_pivot</a></span><span class="op">(</span><span class="va">ndjson_file</span>, <span class="st">"{id: id, type: type}"</span>, as <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="co">##             id        type</span></span>
<span><span class="co">## 1  26939254345 DeleteEvent</span></span>
<span><span class="co">## 2  26939254358   PushEvent</span></span>
<span><span class="co">## 3  26939254361 CreateEvent</span></span>
<span><span class="co">## 4  26939254365 CreateEvent</span></span>
<span><span class="co">## 5  26939254366   PushEvent</span></span>
<span><span class="co">## 6  26939254367   PushEvent</span></span>
<span><span class="co">## 7  26939254379   PushEvent</span></span>
<span><span class="co">## 8  26939254380 IssuesEvent</span></span>
<span><span class="co">## 9  26939254382   PushEvent</span></span>
<span><span class="co">## 10 26939254383   PushEvent</span></span></code></pre></div>
<p>Filtering NDJSON files can require relatively more complicated paths,
e.g., to filter ‘PushEvent’ types from organizations, construct a query
that acts on each NDJSON record to return an array of a single object,
then apply a filter to replace uninteresting elements with 0-length
arrays (using <code>as = "tibble"</code> often transforms the <em>R</em>
list-of-vectors to a tibble in a more pleasing and robust manner
compared to <code>as = "data.frame"</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span></span>
<span>    <span class="st">"[{id: id, type: type, org: org}]</span></span>
<span><span class="st">         [?@.type == 'PushEvent' &amp;&amp; @.org != null]"</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_pivot</a></span><span class="op">(</span><span class="va">ndjson_file</span>, <span class="va">path</span>, as <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="co">##            id      type    org.id          org.login org.gravatar_id</span></span>
<span><span class="co">## 1 26939254358 PushEvent 123667276 johnbieren-testing                </span></span>
<span><span class="co">## 2 26939254382 PushEvent 123667276 johnbieren-testing                </span></span>
<span><span class="co">##                                          org.url</span></span>
<span><span class="co">## 1 https://api.github.com/orgs/johnbieren-testing</span></span>
<span><span class="co">## 2 https://api.github.com/orgs/johnbieren-testing</span></span>
<span><span class="co">##                                       org.avatar_url  org.id.1  org.login.1</span></span>
<span><span class="co">## 1 https://avatars.githubusercontent.com/u/123667276? 120284018 mornystannit</span></span>
<span><span class="co">## 2 https://avatars.githubusercontent.com/u/123667276? 120284018 mornystannit</span></span>
<span><span class="co">##   org.gravatar_id.1                                org.url.1</span></span>
<span><span class="co">## 1                   https://api.github.com/orgs/mornystannit</span></span>
<span><span class="co">## 2                   https://api.github.com/orgs/mornystannit</span></span>
<span><span class="co">##                                     org.avatar_url.1</span></span>
<span><span class="co">## 1 https://avatars.githubusercontent.com/u/120284018?</span></span>
<span><span class="co">## 2 https://avatars.githubusercontent.com/u/120284018?</span></span></code></pre></div>
<p>A more complete example is used in the <a href="https://mtmorgan.github.io/rjsoncons/articles/b_ndjson_extended.html">NDJSON
extended vignette</a></p>
</div>
<div class="section level3">
<h3 id="r-objects-as-input">
<em>R</em> objects as input<a class="anchor" aria-label="anchor" href="#r-objects-as-input"></a>
</h3>
<p><a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a> can
filter and transform <em>R</em> objects. These are converted to JSON
using <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code> before queries are made;
<code>toJSON()</code> arguments like <code>auto_unbox = TRUE</code> can
be added to the function call.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## `lst` is an *R* list</span></span>
<span><span class="va">lst</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">json</span>, simplifyVector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">lst</span>, <span class="st">"locations[?state == 'WA'].name | sort(@)"</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## ["Bellevue","Olympia","Seattle"]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="patch">Patch<a class="anchor" aria-label="anchor" href="#patch"></a>
</h2>
<p><a href="https://jsonpatch.com/" class="external-link">JSON Patch</a> provides a simple way
to edit or transform a JSON document using JSON commands.</p>
<div class="section level3">
<h3 id="applying-a-patch-with-j_patch_apply">Applying a patch with <code>j_patch_apply()</code><a class="anchor" aria-label="anchor" href="#applying-a-patch-with-j_patch_apply"></a>
</h3>
<p>Starting with the JSON document</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">  "biscuits": [</span></span>
<span><span class="st">    { "name": "Digestive" },</span></span>
<span><span class="st">    { "name": "Choco Leibniz" }</span></span>
<span><span class="st">  ]</span></span>
<span><span class="st">}'</span></span></code></pre></div>
<p>one can <code>"add"</code> another biscuit, and copy a favorite
biscuit to a new locations using the following patch</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patch</span> <span class="op">&lt;-</span> <span class="st">'[</span></span>
<span><span class="st">    {"op": "add", "path": "/biscuits/1", "value": { "name": "Ginger Nut" }},</span></span>
<span><span class="st">    {"op": "copy", "from": "/biscuits/2", "path": "/best_biscuit"}</span></span>
<span><span class="st">]'</span></span></code></pre></div>
<p>The paths are specified using <a href="https://datatracker.ietf.org/doc/html/rfc6901" class="external-link">JSONpointer</a>
notation; remember that JSON arrays are 0-based, compared to 1-based
<em>R</em> arrays. Applying the patch results in a new JSON
document.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/patch.html">j_patch_apply</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">patch</span><span class="op">)</span></span>
<span><span class="co">## [1] "{\"biscuits\":[{\"name\":\"Digestive\"},{\"name\":\"Ginger Nut\"},{\"name\":\"Choco Leibniz\"}],\"best_biscuit\":{\"name\":\"Choco Leibniz\"}}"</span></span></code></pre></div>
<p>Patches can also be created from <em>R</em> objects with the helper
function <code><a href="../reference/patch.html">j_patch_op()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/patch.html">j_patch_op</a></span><span class="op">(</span></span>
<span>        <span class="st">"add"</span>, <span class="st">"/biscuits/1"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Ginger Nut"</span><span class="op">)</span>,</span>
<span>        auto_unbox <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/patch.html">j_patch_op</a></span><span class="op">(</span><span class="st">"copy"</span>, <span class="st">"/best_biscuit"</span>, from <span class="op">=</span> <span class="st">"/biscuits/2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/patch.html">j_patch_apply</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">patch</span><span class="op">)</span>, <span class="fu"><a href="../reference/patch.html">j_patch_apply</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">ops</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p><code><a href="../reference/patch.html">j_patch_op()</a></code> takes care of unboxing <code>op=</code>,
<code>path=</code>, and <code>from=</code>, but some care must be taken
in ‘unboxing’ the <code>value=</code> argument for operations such as
‘add’; it may also be appropriate to unbox only specific fields,
e.g.,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/unbox.html" class="external-link">unbox</a></span><span class="op">(</span><span class="st">"Ginger Nut"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/patch.html">j_patch_op</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"/biscuits/1"</span>, value <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span><span class="co">## [</span></span>
<span><span class="co">##   {"op": "add", "path": "/biscuits/1", "value": {"name": "Ginger Nut"}}</span></span>
<span><span class="co">## ]</span></span></code></pre></div>
<p>From the <a href="https://jsonpatch.com/" class="external-link">JSON patch</a> web site,
available operations and example JSON are:</p>
<ul>
<li>
<p><code>add</code> – add elements to an existing document.</p>
<pre><code>{"op": "add", "path": "/biscuits/1", "value": {"name": "Ginger Nut"}}</code></pre>
</li>
<li>
<p><code>remove</code> – remove elements from a document.</p>
<pre><code>{"op": "remove", "path": "/biscuits/0"}</code></pre>
</li>
<li>
<p><code>replace</code> – replace one element with another</p>
<pre><code>{
    "op": "replace", "path": "/biscuits/0/name",
    "value": "Chocolate Digestive"
}</code></pre>
</li>
<li>
<p><code>copy</code> – copy a path to another location.</p>
<pre><code>{"op": "copy", "from": "/biscuits/0", "path": "/best_biscuit"}</code></pre>
</li>
<li>
<p><code>move</code> – move a path to another location.</p>
<pre><code>{"op": "move", "from": "/biscuits", "path": "/cookies"}</code></pre>
</li>
<li>
<p><code>test</code> – test for the existence of a path; if the path
does not exist, do not apply any of the patch.</p>
<pre><code>{"op": "test", "path": "/best_biscuit/name", "value": "Choco Leibniz"}</code></pre>
</li>
</ul>
<p>Formal description of these operations is provided in Section 4 of <a href="https://datatracker.ietf.org/doc/html/rfc6902/#section-4" class="external-link">RFC6902</a>.
A patch command is <em>always</em> an array, even when a single
operation is involved.</p>
</div>
<div class="section level3">
<h3 id="difference-between-documents-with-j_patch_from">Difference between documents with <code>j_patch_from()</code><a class="anchor" aria-label="anchor" href="#difference-between-documents-with-j_patch_from"></a>
</h3>
<p>The <code><a href="../reference/patch.html">j_patch_from()</a></code> function constructs a patch from the
difference between two documents</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/patch.html">j_patch_from</a></span><span class="op">(</span><span class="fu"><a href="../reference/patch.html">j_patch_apply</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">patch</span><span class="op">)</span>, <span class="va">json</span><span class="op">)</span></span>
<span><span class="co">## [1] "[{\"op\":\"replace\",\"path\":\"/biscuits/1/name\",\"value\":\"Choco Leibniz\"},{\"op\":\"remove\",\"path\":\"/biscuits/2\"},{\"op\":\"remove\",\"path\":\"/best_biscuit\"}]"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="schema-validation">Schema validation<a class="anchor" aria-label="anchor" href="#schema-validation"></a>
</h2>
<p><a href="https://json-schema.org/" class="external-link">JSON schema</a> provides structure
to JSON documents. <code><a href="../reference/schema.html">j_schema_is_valid()</a></code> checks that a JSON
document is valid against a specified schema, and
<code><a href="../reference/schema.html">j_schema_validate()</a></code> tries to illustrate how a document
deviates from the schema.</p>
<p>As an example consider <code><a href="../reference/patch.html">j_patch_op()</a></code>, where the operation
is supposed to conform to the <a href="https://jsonpatch.com/" class="external-link">JSON
patch</a> schema. For convenience, a copy of this schema is available in
<a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## alternatively: schema &lt;- "https://json.schemastore.org/json-patch"</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rjsoncons"</span>, <span class="st">"extdata"</span>, <span class="st">"json-patch.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##   "$schema": "http://json-schema.org/draft-04/schema#",</span></span>
<span><span class="co">##   "definitions": {</span></span>
<span><span class="co">##     "path": {</span></span>
<span><span class="co">##       "description": "A JSON Pointer path.",</span></span>
<span><span class="co">##       "type": "string"</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "id": "https://json.schemastore.org/json-patch.json",</span></span>
<span><span class="co">##   "items": {</span></span>
<span><span class="co">##     "oneOf": [</span></span>
<span><span class="co">##       {</span></span>
<span><span class="co">##         "additionalProperties": false,</span></span>
<span><span class="co">##         "required": ["value", "op", "path"],</span></span>
<span><span class="co">##         "properties": {</span></span>
<span><span class="co">##           "path": {</span></span>
<span><span class="co">##             "$ref": "#/definitions/path"</span></span>
<span><span class="co">##           },</span></span>
<span><span class="co">##           "op": {</span></span>
<span><span class="co">##             "description": "The operation to perform.",</span></span>
<span><span class="co">##             "type": "string",</span></span>
<span><span class="co">##             "enum": ["add", "replace", "test"]</span></span>
<span><span class="co">##           },</span></span>
<span><span class="co">##           "value": {</span></span>
<span><span class="co">##             "description": "The value to add, replace or test."</span></span>
<span><span class="co">##           }</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       {</span></span>
<span><span class="co">##         "additionalProperties": false,</span></span>
<span><span class="co">##         "required": ["op", "path"],</span></span>
<span><span class="co">##         "properties": {</span></span>
<span><span class="co">##           "path": {</span></span>
<span><span class="co">##             "$ref": "#/definitions/path"</span></span>
<span><span class="co">##           },</span></span>
<span><span class="co">##           "op": {</span></span>
<span><span class="co">##             "description": "The operation to perform.",</span></span>
<span><span class="co">##             "type": "string",</span></span>
<span><span class="co">##             "enum": ["remove"]</span></span>
<span><span class="co">##           }</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       {</span></span>
<span><span class="co">##         "additionalProperties": false,</span></span>
<span><span class="co">##         "required": ["from", "op", "path"],</span></span>
<span><span class="co">##         "properties": {</span></span>
<span><span class="co">##           "path": {</span></span>
<span><span class="co">##             "$ref": "#/definitions/path"</span></span>
<span><span class="co">##           },</span></span>
<span><span class="co">##           "op": {</span></span>
<span><span class="co">##             "description": "The operation to perform.",</span></span>
<span><span class="co">##             "type": "string",</span></span>
<span><span class="co">##             "enum": ["move", "copy"]</span></span>
<span><span class="co">##           },</span></span>
<span><span class="co">##           "from": {</span></span>
<span><span class="co">##             "$ref": "#/definitions/path",</span></span>
<span><span class="co">##             "description": "A JSON Pointer path pointing to the location to move/copy from."</span></span>
<span><span class="co">##           }</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     ]</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "title": "JSON schema for JSONPatch files",</span></span>
<span><span class="co">##   "type": "array"</span></span>
<span><span class="co">## }</span></span></code></pre></div>
<p>The well-formed ‘op’ is valid, and <code><a href="../reference/schema.html">j_schema_validate()</a></code>
produces no output</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="st">'[{</span></span>
<span><span class="st">    "op": "add", "path": "/biscuits/1",</span></span>
<span><span class="st">    "value": { "name": "Ginger Nut" }</span></span>
<span><span class="st">}]'</span></span>
<span><span class="fu"><a href="../reference/schema.html">j_schema_is_valid</a></span><span class="op">(</span><span class="va">op</span>, <span class="va">schema</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/schema.html">j_schema_validate</a></span><span class="op">(</span><span class="va">op</span>, <span class="va">schema</span><span class="op">)</span></span>
<span><span class="co">## [1] "[]"</span></span></code></pre></div>
<p>Introduce an invalid ‘op’, <code>"op": "invalid_op"</code>, and the
schema is no longer valid.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="st">'[{</span></span>
<span><span class="st">    "op": "invalid_op", "path": "/biscuits/1",</span></span>
<span><span class="st">    "value": { "name": "Ginger Nut" }</span></span>
<span><span class="st">}]'</span></span>
<span><span class="fu"><a href="../reference/schema.html">j_schema_is_valid</a></span><span class="op">(</span><span class="va">op</span>, <span class="va">schema</span><span class="op">)</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre></div>
<p>The reason can be understood from (careful!) consideration of the
output of <code><a href="../reference/schema.html">j_schema_validate()</a></code>, with reference to the schema
itself.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/schema.html">j_schema_validate</a></span><span class="op">(</span><span class="va">op</span>, <span class="va">schema</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 1</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ valid            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE</span></span>
<span><span class="co">## $ evaluationPath   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/items/oneOf"</span></span>
<span><span class="co">## $ schemaLocation   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "https://json.schemastore.org/json-patch.json#/items/…</span></span>
<span><span class="co">## $ instanceLocation <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/0"</span></span>
<span><span class="co">## $ error            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "No schema matched, but exactly one of them is requir…</span></span>
<span><span class="co">## $ details          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> [[FALSE, "/items/oneOf/0/properties/op/enum", "https:…</span></span></code></pre></div>
<p>The validation indicates that the schema <code>evaluationPath</code>
‘/items/oneOf’ is not satisfied, because of the <code>error</code> ‘No
schema [i.e., ’oneOf’ elements] matched, …’.</p>
<p>The ‘details’ column summarizes why each of the 3 elements of
<code>/items/oneOf</code> fails the schema specification; use
<code>as = "details"</code> to extract this directly</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/schema.html">j_schema_validate</a></span><span class="op">(</span><span class="va">op</span>, <span class="va">schema</span>, as <span class="op">=</span> <span class="st">"details"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 6</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## $ valid            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE</span></span>
<span><span class="co">## $ evaluationPath   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/items/oneOf/0/properties/op/enum", "/items/oneOf/1/…</span></span>
<span><span class="co">## $ schemaLocation   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "https://json.schemastore.org/json-patch.json#/items/…</span></span>
<span><span class="co">## $ instanceLocation <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/0/op", "/0/op", "/0/value", "/0", "/0/op", "/0/valu…</span></span>
<span><span class="co">## $ error            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "'invalid_op' is not a valid enum value.", "'invalid_…</span></span></code></pre></div>
<p>This indicates that the first item in the schema is rejected because
‘invalid_op’ is not a valid enum</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">schema</span>, <span class="st">"/items/oneOf/0/properties/op/enum"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] ["add","replace","test"]</span></span></code></pre></div>
<p>Reasons for rejecting other items can be explored using similar
steps.</p>
</div>
<div class="section level2">
<h2 id="flatten-and-find">Flatten and find<a class="anchor" aria-label="anchor" href="#flatten-and-find"></a>
</h2>
<p>It can sometimes be helpful to explore JSON documents by ‘flattening’
the JSON to an object of path / value pairs, where the path is the <a href="https://datatracker.ietf.org/doc/html/rfc6901" class="external-link">JSONpointer</a>
path to the corresponding value. It is then straight-forward to search
this flattened object for, e.g., the path to a known field or value. As
an example, consider the object</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">    "discards": {</span></span>
<span><span class="st">        "1000": "Record does not exist",</span></span>
<span><span class="st">        "1004": "Queue limit exceeded",</span></span>
<span><span class="st">        "1010": "Discarding timed-out partial msg"</span></span>
<span><span class="st">    },</span></span>
<span><span class="st">    "warnings": {</span></span>
<span><span class="st">        "0": "Phone number missing country code",</span></span>
<span><span class="st">        "1": "State code missing",</span></span>
<span><span class="st">        "2": "Zip code missing"</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">}'</span></span></code></pre></div>
<p>The ‘flat’ JSON of this can be represented as named list (using
<code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> to provide a compact visual representation)</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flatten.html">j_flatten</a></span><span class="op">(</span><span class="va">codes</span>, as <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 6</span></span>
<span><span class="co">##  $ /discards/1000: chr "Record does not exist"</span></span>
<span><span class="co">##  $ /discards/1004: chr "Queue limit exceeded"</span></span>
<span><span class="co">##  $ /discards/1010: chr "Discarding timed-out partial msg"</span></span>
<span><span class="co">##  $ /warnings/0   : chr "Phone number missing country code"</span></span>
<span><span class="co">##  $ /warnings/1   : chr "State code missing"</span></span>
<span><span class="co">##  $ /warnings/2   : chr "Zip code missing"</span></span></code></pre></div>
<p>The names of the list are JSONpointer (default) or JSONpath, so can
be used in <code><a href="../reference/rquerypivot.html">j_query()</a></code> and <code><a href="../reference/rquerypivot.html">j_pivot()</a></code> as
appropriate</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">codes</span>, <span class="st">"/discards/1010"</span><span class="op">)</span></span>
<span><span class="co">## [1] "Discarding timed-out partial msg"</span></span></code></pre></div>
<p>There are two ways to find known keys and values. The first is to use
exact matching to one or more keys or values, e.g.,</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flatten.html">j_find_values</a></span><span class="op">(</span></span>
<span>    <span class="va">codes</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Record does not exist"</span>, <span class="st">"State code missing"</span><span class="op">)</span>,</span>
<span>    as <span class="op">=</span> <span class="st">"tibble"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   path           value                </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /discards/1000 Record does not exist</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> /warnings/1    State code missing</span></span>
<span><span class="fu"><a href="../reference/flatten.html">j_find_keys</a></span><span class="op">(</span><span class="va">codes</span>, <span class="st">"warnings"</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   path        value                            </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /warnings/0 Phone number missing country code</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> /warnings/1 State code missing               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> /warnings/2 Zip code missing</span></span></code></pre></div>
<p>It is also possible to match using a regular expression.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flatten.html">j_find_values_grep</a></span><span class="op">(</span><span class="va">codes</span>, <span class="st">"missing"</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   path        value                            </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /warnings/0 Phone number missing country code</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> /warnings/1 State code missing               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> /warnings/2 Zip code missing</span></span>
<span><span class="fu"><a href="../reference/flatten.html">j_find_keys_grep</a></span><span class="op">(</span><span class="va">codes</span>, <span class="st">"card.*/100"</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span> <span class="co"># span key delimiters</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   path           value                </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /discards/1000 Record does not exist</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> /discards/1004 Queue limit exceeded</span></span></code></pre></div>
<p>Keys are always character vectors, but values can be of different
type; <code><a href="../reference/flatten.html">j_find_values()</a></code> supports searches on these.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">j</span> <span class="op">&lt;-</span> <span class="st">'{"x":[1,[2, 3]],"y":{"a":4}}'</span></span>
<span><span class="fu"><a href="../reference/flatten.html">j_flatten</a></span><span class="op">(</span><span class="va">j</span>, as <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 4</span></span>
<span><span class="co">##  $ /x/0  : int 1</span></span>
<span><span class="co">##  $ /x/1/0: int 2</span></span>
<span><span class="co">##  $ /x/1/1: int 3</span></span>
<span><span class="co">##  $ /y/a  : int 4</span></span>
<span><span class="fu"><a href="../reference/flatten.html">j_find_values</a></span><span class="op">(</span><span class="va">j</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   path   value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /x/1/0     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> /y/a       4</span></span></code></pre></div>
<p>A common operation might be to find the path to a know value, and
then to query the original JSON to find the object in which the value is
contained.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flatten.html">j_find_values</a></span><span class="op">(</span><span class="va">j</span>, <span class="fl">3</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">##   path   value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> /x/1/1     3</span></span>
<span><span class="co">## path to '3' is '/x/1/1', so containing object is at '/x/1'</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"/x/1"</span><span class="op">)</span></span>
<span><span class="co">## [1] "[2,3]"</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">j</span>, <span class="st">"/x/1"</span>, as <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="co">## [1] 2 3</span></span></code></pre></div>
<p>Both JSONpointer and JSONpath are supported; an advantage of the
latter is that the path distinguishes between integer-valued (unquoted)
and string-valued (quoted) keys</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flatten.html">j_find_values</a></span><span class="op">(</span><span class="va">j</span>, <span class="fl">3</span>, as <span class="op">=</span> <span class="st">"tibble"</span>, path_type <span class="op">=</span> <span class="st">"JSONpath"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">##   path         value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> $['x'][1][1]     3</span></span></code></pre></div>
<p>The first argument to <code>j_find_*()</code> can be an <em>R</em>
object, JSON or NDJSON string, file, or URL. Using
<code><a href="../reference/flatten.html">j_find_values()</a></code> with an <em>R</em> object and JSONpath
<code>path_type</code> leads to a path that is easily converted into an
<em>R</em> index: double the <code>[</code> and <code>]</code> in the
path and increment each numerical index by 1:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/flatten.html">j_find_values</a></span><span class="op">(</span><span class="va">l</span>, <span class="fl">3</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>, path_type <span class="op">=</span> <span class="st">"JSONpath"</span>, as <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">##   path         value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> $['x'][1][1]     3</span></span>
<span><span class="va">l</span><span class="op">[[</span><span class="st">'x'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># siblings</span></span>
<span><span class="co">## [1] 2 3</span></span></code></pre></div>
<p>NDJSON files are flattened into character vectors, with each element
the flattened version of the corresponding NDJSON record.</p>
</div>
<div class="section level2">
<h2 id="the-json-parser">The JSON parser<a class="anchor" aria-label="anchor" href="#the-json-parser"></a>
</h2>
<p>The package includes a JSON parser, used with the argument
<code>as = "R"</code> or directly with <code><a href="../reference/as_r.html">as_r()</a></code></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'{"a": 1.0, "b": [2, 3, 4]}'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ a: num 1</span></span>
<span><span class="co">#&gt;  $ b: int [1:3] 2 3 4</span></span></code></pre></div>
<p>The main rules of this transformation are outlined here. JSON arrays
of a single type (boolean, integer, double, string) are transformed to
<em>R</em> vectors of the same length and corresponding type.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[true, false, true]'</span><span class="op">)</span> <span class="co"># boolean -&gt; logical</span></span>
<span><span class="co">## [1]  TRUE FALSE  TRUE</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[1, 2, 3]'</span><span class="op">)</span>           <span class="co"># integer -&gt; integer</span></span>
<span><span class="co">## [1] 1 2 3</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[1.0, 2.0, 3.0]'</span><span class="op">)</span>     <span class="co"># double  -&gt; numeric</span></span>
<span><span class="co">## [1] 1 2 3</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'["a", "b", "c"]'</span><span class="op">)</span>     <span class="co"># string  -&gt; character</span></span>
<span><span class="co">## [1] "a" "b" "c"</span></span></code></pre></div>
<p>JSON arrays mixing integer and double values are transformed to
<em>R</em> numeric vectors.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[1, 2.0]'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># numeric</span></span>
<span><span class="co">## [1] "numeric"</span></span></code></pre></div>
<p>If a JSON integer array contains a value larger than <em>R</em>’s
32-bit integer representation, the array is transformed to an <em>R</em>
numeric vector. NOTE that this results in loss of precision for JSON
integer values greater than <code>2^53</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[1, 2147483648]'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># 64-bit integers -&gt; numeric</span></span>
<span><span class="co">## [1] "numeric"</span></span></code></pre></div>
<p>JSON objects are transformed to <em>R</em> named lists.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'{}'</span><span class="op">)</span></span>
<span><span class="co">## named list()</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'{"a": 1.0, "b": [2, 3, 4]}'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ a: num 1</span></span>
<span><span class="co">##  $ b: int [1:3] 2 3 4</span></span></code></pre></div>
<p>There are several additional details. A JSON scalar and a JSON vector
of length 1 are represented in the same way in <em>R</em>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">"3.14"</span><span class="op">)</span>, <span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">"[3.14]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>JSON arrays mixing types other than integer and double are
transformed to <em>R</em> lists</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[true, 1, "a"]'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ : logi TRUE</span></span>
<span><span class="co">##  $ : int 1</span></span>
<span><span class="co">##  $ : chr "a"</span></span></code></pre></div>
<p>JSON <code>null</code> values are represented as <em>R</em>
<code>NULL</code> values; arrays of <code>null</code> are transformed to
lists</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'null'</span><span class="op">)</span>                  <span class="co"># NULL</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[null]'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span>       <span class="co"># list(NULL)</span></span>
<span><span class="co">## List of 1</span></span>
<span><span class="co">##  $ : NULL</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="st">'[null, null]'</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># list(NULL, NULL)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ : NULL</span></span>
<span><span class="co">##  $ : NULL</span></span></code></pre></div>
<p>Ordering of object members is controlled by the
<code>object_names=</code> argument. The default preserves names as they
appear in the JSON definition; use <code>"sort"</code> to sort names
alphabetically. This argument is applied recursively.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span> <span class="op">&lt;-</span> <span class="st">'{"b": 1, "a": {"d": 2, "c": 3}}'</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="va">json</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ b: int 1</span></span>
<span><span class="co">##  $ a:List of 2</span></span>
<span><span class="co">##   ..$ d: int 2</span></span>
<span><span class="co">##   ..$ c: int 3</span></span>
<span><span class="fu"><a href="../reference/as_r.html">as_r</a></span><span class="op">(</span><span class="va">json</span>, object_names <span class="op">=</span> <span class="st">"sort"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ a:List of 2</span></span>
<span><span class="co">##   ..$ c: int 3</span></span>
<span><span class="co">##   ..$ d: int 2</span></span>
<span><span class="co">##  $ b: int 1</span></span></code></pre></div>
<p>The parser corresponds approximately to
<code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">jsonlite::fromJSON()</a></code> with arguments
<code>simplifyVector = TRUE, simplifyDataFrame = FALSE, simplifyMatrix = FALSE)</code>.
Unit tests (using the <a href="https://CRAN.R-project.org/package=tinytest" class="external-link">tinytest</a>
framework) providing additional details are available at</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rjsoncons"</span>, <span class="st">"tinytest"</span>, <span class="st">"test_as_r.R"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="using-jsonlitefromjson">Using <code>jsonlite::fromJSON()</code><a class="anchor" aria-label="anchor" href="#using-jsonlitefromjson"></a>
</h3>
<p>The built-in parser can be replaced by alternative parsers by
returning the query as a JSON string, e.g., using the
<code>fromJSON()</code> in the <a href="https://CRAN.R-project.org/package=jsonlite" class="external-link">jsonlite</a>
package.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">  "locations": [</span></span>
<span><span class="st">    {"name": "Seattle", "state": "WA"},</span></span>
<span><span class="st">    {"name": "New York", "state": "NY"},</span></span>
<span><span class="st">    {"name": "Bellevue", "state": "WA"},</span></span>
<span><span class="st">    {"name": "Olympia", "state": "WA"}</span></span>
<span><span class="st">  ]</span></span>
<span><span class="st">}'</span></span>
<span><span class="fu"><a href="../reference/rquerypivot.html">j_query</a></span><span class="op">(</span><span class="va">json</span>, <span class="st">"locations[?state == 'WA']"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co">## `fromJSON()` simplifies list-of-objects to data.frame</span></span>
<span>    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##       name state</span></span>
<span><span class="co">## 1  Seattle    WA</span></span>
<span><span class="co">## 2 Bellevue    WA</span></span>
<span><span class="co">## 3  Olympia    WA</span></span></code></pre></div>
<p>The <a href="https://mtmorgan.github.io/rjsoncons/">rjsoncons</a>
package is particularly useful when accessing elements that might
otherwise require complicated application of nested
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>, <a href="https://CRAN.R-project.org/package=purrr" class="external-link">purrr</a> expressions,
or <a href="https://CRAN.R-project.org/package=tidyr" class="external-link">tidyr</a>
<code>unnest_*()</code> (see <a href="https://r4ds.hadley.nz/" class="external-link">R for
Data Science</a> chapter ‘<a href="https://r4ds.hadley.nz/rectangling" class="external-link">Hierarchical data</a>’).</p>
</div>
</div>
<div class="section level2">
<h2 id="c-library-use-in-other-packages">C++ library use in other packages<a class="anchor" aria-label="anchor" href="#c-library-use-in-other-packages"></a>
</h2>
<p>The package includes the complete ‘jsoncons’ C++ header-only library,
available to other R packages by adding</p>
<pre><code><span><span class="va">LinkingTo</span><span class="op">:</span> <span class="va">rjsoncons</span></span>
<span><span class="va">SystemRequirements</span><span class="op">:</span> <span class="va">C</span><span class="op">+</span><span class="op">+</span><span class="fl">11</span></span></code></pre>
<p>to the DESCRIPTION file. Typical use in an R package would also
include <code>LinkingTo:</code> specifications for the <a href="https://cran.r-project.org/package=cpp11" class="external-link">cpp11</a> or <a href="https://cran.r-project.org/package=Rcpp" class="external-link">Rcpp</a> (this package
uses <a href="https://cran.r-project.org/package=cpp11" class="external-link">cpp11</a>)
packages to provide a C / C++ interface between R and the C++ ‘jsoncons’
library.</p>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>This vignette was compiled using the following software versions</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## R version 4.4.0 (2024-04-24)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] rjsoncons_1.3.0.9000 BiocStyle_2.32.0    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] vctrs_0.6.5         cli_3.6.2           knitr_1.46         </span></span>
<span><span class="co">##  [4] rlang_1.1.3         xfun_0.43           purrr_1.0.2        </span></span>
<span><span class="co">##  [7] textshaping_0.3.7   jsonlite_1.8.8      glue_1.7.0         </span></span>
<span><span class="co">## [10] htmltools_0.5.8.1   ragg_1.3.0          sass_0.4.9         </span></span>
<span><span class="co">## [13] fansi_1.0.6         rmarkdown_2.26      tibble_3.2.1       </span></span>
<span><span class="co">## [16] evaluate_0.23       jquerylib_0.1.4     fastmap_1.1.1      </span></span>
<span><span class="co">## [19] yaml_2.3.8          lifecycle_1.0.4     memoise_2.0.1      </span></span>
<span><span class="co">## [22] bookdown_0.39       BiocManager_1.30.23 compiler_4.4.0     </span></span>
<span><span class="co">## [25] fs_1.6.4            pkgconfig_2.0.3     systemfonts_1.0.6  </span></span>
<span><span class="co">## [28] digest_0.6.35       R6_2.5.1            utf8_1.2.4         </span></span>
<span><span class="co">## [31] pillar_1.9.0        magrittr_2.0.3      bslib_0.7.0        </span></span>
<span><span class="co">## [34] tools_4.4.0         pkgdown_2.0.9       cachem_1.0.8       </span></span>
<span><span class="co">## [37] desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Morgan, Marcel Ramos, Daniel Parker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
